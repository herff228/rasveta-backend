const axios = require('axios');

const generateAllTasks = async () => {
  try {
    console.log('üîÑ –ì–µ–Ω–µ—Ä–∏—Ä—É—é 9 –∑–∞–¥–∞–Ω–∏–π —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏...');
    
    const response = await axios.post(
      'https://api.mistral.ai/v1/chat/completions',
      {
        model: 'mistral-tiny',
        messages: [
          {
            role: 'user',
            content: `–ü—Ä–∏–¥—É–º–∞–π 9 —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π –¥–ª—è —Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏—è (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —É—Ä–æ–≤–µ–Ω—å —Å 1 –ø–æ 9). 
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –ø—Ä–∏–¥—É–º–∞–π –ö–û–†–û–¢–ö–û–ï –ù–ê–ó–í–ê–ù–ò–ï (2-4 —Å–ª–æ–≤–∞) –∏ —Å–∞–º–æ –∑–∞–¥–∞–Ω–∏–µ (–æ–ø–∏—Å–∞–Ω–∏–µ).

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ —Å—Ç—Ä–æ–≥–æ:
–ù–∞–∑–≤–∞–Ω–∏–µ 1: [–Ω–∞–∑–≤–∞–Ω–∏–µ]
–ó–∞–¥–∞–Ω–∏–µ 1: [–æ–ø–∏—Å–∞–Ω–∏–µ]

–ù–∞–∑–≤–∞–Ω–∏–µ 2: [–Ω–∞–∑–≤–∞–Ω–∏–µ]
–ó–∞–¥–∞–Ω–∏–µ 2: [–æ–ø–∏—Å–∞–Ω–∏–µ]

–ò —Ç–∞–∫ –¥–æ 9.

–ü—Ä–∏–º–µ—Ä:
–ù–∞–∑–≤–∞–Ω–∏–µ 1: –£—Ç—Ä–µ–Ω–Ω—è—è –ø—Ä–æ–≥—É–ª–∫–∞
–ó–∞–¥–∞–Ω–∏–µ 1: –ø–æ–≥—É–ª—è–π –≤ –ø–∞—Ä–∫–µ 30 –º–∏–Ω—É—Ç, —Å–ª—É—à–∞—è –ø–µ–Ω–∏–µ –ø—Ç–∏—Ü

–ù–∞–∑–≤–∞–Ω–∏–µ 2: –ß–∞—Å —Å –∫–Ω–∏–≥–æ–π
–ó–∞–¥–∞–Ω–∏–µ 2: –ø—Ä–æ—á–∏—Ç–∞–π 20 —Å—Ç—Ä–∞–Ω–∏—Ü –ª—é–±–æ–π –∫–Ω–∏–≥–∏ –≤ —Ç–∏—à–∏–Ω–µ

–ù–∞–∑–≤–∞–Ω–∏–µ 3: –¢–≤–æ—Ä—á–µ—Å–∫–∏–π –≤–µ—á–µ—Ä
–ó–∞–¥–∞–Ω–∏–µ 3: –Ω–∞—Ä–∏—Å—É–π –ø–µ–π–∑–∞–∂ –∞–∫–≤–∞—Ä–µ–ª—å—é –∏–ª–∏ –∫–∞—Ä–∞–Ω–¥–∞—à–∞–º–∏`
          }
        ],
        temperature: 0.9,
        max_tokens: 500
      },
      {
        headers: {
          'Authorization': `Bearer ${process.env.MISTRAL_API_KEY}`,
          'Content-Type': 'application/json'
        }
      }
    );
    
    const content = response.data.choices[0].message.content;
    console.log('‚úÖ –û—Ç–≤–µ—Ç –æ—Ç Mistral –ø–æ–ª—É—á–µ–Ω');
    
    const tasks = [];
    const lines = content.split('\n').filter(line => line.trim() !== '');
    
    for (let i = 1; i <= 9; i++) {
      // –ò—â–µ–º —Å—Ç—Ä–æ–∫—É —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
      let titleLine = lines.find(l => l.includes(`–ù–∞–∑–≤–∞–Ω–∏–µ ${i}:`)) || 
                      lines.find(l => l.toLowerCase().includes(`–Ω–∞–∑–≤–∞–Ω–∏–µ ${i}`));
      let taskLine = lines.find(l => l.includes(`–ó–∞–¥–∞–Ω–∏–µ ${i}:`)) || 
                     lines.find(l => l.toLowerCase().includes(`–∑–∞–¥–∞–Ω–∏–µ ${i}`));
      
      let title = '';
      let task = '';
      
      if (titleLine) {
        title = titleLine.split(':')[1]?.trim() || '';
        // –û—á–∏—â–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ç MarkDown –∏ –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤
        title = title.replace(/\*\*/g, '').replace(/\*/g, '').replace(/_/g, '').trim();
      }
      
      if (taskLine) {
        task = taskLine.split(':')[1]?.trim() || '';
        task = task.replace(/\*\*/g, '').replace(/\*/g, '').replace(/_/g, '').trim();
      }
      
      // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ –∑–∞–¥–∞–Ω–∏–µ ‚Äì –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–ø–∞—Å–Ω—ã–µ
      if (!title) title = getDefaultTitle(i);
      if (!task) task = getDefaultTask(i);
      
      tasks.push({ title, task });
    }
    
    console.log('‚úÖ –ó–∞–¥–∞–Ω–∏—è —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã:');
    tasks.forEach((t, i) => console.log(`   –£—Ä–æ–≤–µ–Ω—å ${i+1}: ${t.title} ‚Äî ${t.task}`));
    
    return tasks;
    
  } catch (error) {
    console.log('‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, –±–µ—Ä—É –∏–∑ —Å–ø–∏—Å–∫–∞');
    return getDefaultTasks();
  }
};

const getDefaultTitle = (level) => {
  const titles = {
    1: "–£—Ç—Ä–µ–Ω–Ω—è—è –ø—Ä–æ–≥—É–ª–∫–∞",
    2: "–ß–∞—Å —Å –∫–Ω–∏–≥–æ–π",
    3: "–¢–≤–æ—Ä—á–µ—Å–∫–∏–π –≤–µ—á–µ—Ä",
    4: "–ö—É–ª–∏–Ω–∞—Ä–Ω—ã–π —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç",
    5: "–ó–∞—Ä—è–¥–∫–∞ –¥–ª—è —Ç–µ–ª–∞",
    6: "–ó–≤–æ–Ω–æ–∫ –±–ª–∏–∑–∫–∏–º",
    7: "–ü—Ä–æ–≥—É–ª–∫–∞ –Ω–∞ –ø—Ä–∏—Ä–æ–¥–µ",
    8: "–ö—É–ª—å—Ç—É—Ä–Ω—ã–π –≤—ã—Ö–æ–¥",
    9: "–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±—É–¥—É—â–µ–≥–æ"
  };
  return titles[level] || `–£—Ä–æ–≤–µ–Ω—å ${level}`;
};

const getDefaultTask = (level) => {
  const tasks = {
    1: "–ø–æ–≥—É–ª—è–π –≤ –ø–∞—Ä–∫–µ 30 –º–∏–Ω—É—Ç, —Å–ª—É—à–∞—è –ø–µ–Ω–∏–µ –ø—Ç–∏—Ü",
    2: "–ø—Ä–æ—á–∏—Ç–∞–π 20 —Å—Ç—Ä–∞–Ω–∏—Ü –ª—é–±–æ–π –∫–Ω–∏–≥–∏ –≤ —Ç–∏—à–∏–Ω–µ",
    3: "–Ω–∞—Ä–∏—Å—É–π –ø–µ–π–∑–∞–∂ –∞–∫–≤–∞—Ä–µ–ª—å—é –∏–ª–∏ –∫–∞—Ä–∞–Ω–¥–∞—à–∞–º–∏",
    4: "–ø—Ä–∏–≥–æ—Ç–æ–≤—å –Ω–æ–≤–æ–µ –±–ª—é–¥–æ –ø–æ —Ä–µ—Ü–µ–ø—Ç—É –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞",
    5: "—Å–¥–µ–ª–∞–π 20 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π, 15 –æ—Ç–∂–∏–º–∞–Ω–∏–π, –ø–ª–∞–Ω–∫–∞ 2 –º–∏–Ω—É—Ç—ã",
    6: "–ø–æ–∑–≤–æ–Ω–∏ –¥—Ä—É–≥—É –∏–ª–∏ —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫—É, —Å –∫–æ—Ç–æ—Ä—ã–º –¥–∞–≤–Ω–æ –Ω–µ –æ–±—â–∞–ª—Å—è",
    7: "—Å—Ö–æ–¥–∏ –≤ –ª–µ—Å –∏–ª–∏ –ø–∞—Ä–∫, —Å–æ–±–µ—Ä–∏ –±—É–∫–µ—Ç –∏–∑ –ª–∏—Å—Ç—å–µ–≤",
    8: "–ø–æ—Å–µ—Ç–∏ –º—É–∑–µ–π, –≤—ã—Å—Ç–∞–≤–∫—É –∏–ª–∏ –≥–∞–ª–µ—Ä–µ—é",
    9: "–Ω–∞–ø–∏—à–∏ –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø–ª–∞–Ω –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü"
  };
  return tasks[level] || tasks[1];
};

const getDefaultTasks = () => {
  return [
    { title: "–£—Ç—Ä–µ–Ω–Ω—è—è –ø—Ä–æ–≥—É–ª–∫–∞", task: "–ø–æ–≥—É–ª—è–π –≤ –ø–∞—Ä–∫–µ 30 –º–∏–Ω—É—Ç, —Å–ª—É—à–∞—è –ø–µ–Ω–∏–µ –ø—Ç–∏—Ü" },
    { title: "–ß–∞—Å —Å –∫–Ω–∏–≥–æ–π", task: "–ø—Ä–æ—á–∏—Ç–∞–π 20 —Å—Ç—Ä–∞–Ω–∏—Ü –ª—é–±–æ–π –∫–Ω–∏–≥–∏ –≤ —Ç–∏—à–∏–Ω–µ" },
    { title: "–¢–≤–æ—Ä—á–µ—Å–∫–∏–π –≤–µ—á–µ—Ä", task: "–Ω–∞—Ä–∏—Å—É–π –ø–µ–π–∑–∞–∂ –∞–∫–≤–∞—Ä–µ–ª—å—é –∏–ª–∏ –∫–∞—Ä–∞–Ω–¥–∞—à–∞–º–∏" },
    { title: "–ö—É–ª–∏–Ω–∞—Ä–Ω—ã–π —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç", task: "–ø—Ä–∏–≥–æ—Ç–æ–≤—å –Ω–æ–≤–æ–µ –±–ª—é–¥–æ –ø–æ —Ä–µ—Ü–µ–ø—Ç—É –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞" },
    { title: "–ó–∞—Ä—è–¥–∫–∞ –¥–ª—è —Ç–µ–ª–∞", task: "—Å–¥–µ–ª–∞–π 20 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π, 15 –æ—Ç–∂–∏–º–∞–Ω–∏–π, –ø–ª–∞–Ω–∫–∞ 2 –º–∏–Ω—É—Ç—ã" },
    { title: "–ó–≤–æ–Ω–æ–∫ –±–ª–∏–∑–∫–∏–º", task: "–ø–æ–∑–≤–æ–Ω–∏ –¥—Ä—É–≥—É –∏–ª–∏ —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫—É, —Å –∫–æ—Ç–æ—Ä—ã–º –¥–∞–≤–Ω–æ –Ω–µ –æ–±—â–∞–ª—Å—è" },
    { title: "–ü—Ä–æ–≥—É–ª–∫–∞ –Ω–∞ –ø—Ä–∏—Ä–æ–¥–µ", task: "—Å—Ö–æ–¥–∏ –≤ –ª–µ—Å –∏–ª–∏ –ø–∞—Ä–∫, —Å–æ–±–µ—Ä–∏ –±—É–∫–µ—Ç –∏–∑ –ª–∏—Å—Ç—å–µ–≤" },
    { title: "–ö—É–ª—å—Ç—É—Ä–Ω—ã–π –≤—ã—Ö–æ–¥", task: "–ø–æ—Å–µ—Ç–∏ –º—É–∑–µ–π, –≤—ã—Å—Ç–∞–≤–∫—É –∏–ª–∏ –≥–∞–ª–µ—Ä–µ—é" },
    { title: "–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±—É–¥—É—â–µ–≥–æ", task: "–Ω–∞–ø–∏—à–∏ –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø–ª–∞–Ω –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü" }
  ];
};

module.exports = { generateAllTasks };